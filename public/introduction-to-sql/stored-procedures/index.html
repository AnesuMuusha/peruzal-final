<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>Stored Procedures - Introduction to SQL</title>
    <meta name="generator" content="Hugo 0.19" />

    
    <meta name="description" content="Introduction to SQL Guide">
    
    <link rel="canonical" href="http://guides.peruzal.com/introduction-to-sql/stored-procedures/">
    
    <meta name="author" content="Peruzal">
    

    <meta property="og:url" content="http://guides.peruzal.com/introduction-to-sql/stored-procedures/">
    <meta property="og:title" content="Introduction to SQL">
    <meta property="og:image" content="http://guides.peruzal.com/images/logo.png">
    <meta name="apple-mobile-web-app-title" content="Introduction to SQL">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="http://guides.peruzal.com/introduction-to-sql/images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="http://guides.peruzal.com/introduction-to-sql/images/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('http://guides.peruzal.com/introduction-to-sql/fonts/icon.eot');
        src: url('http://guides.peruzal.com/introduction-to-sql/fonts/icon.eot')
               format('embedded-opentype'),
             url('http://guides.peruzal.com/introduction-to-sql/fonts/icon.woff')
               format('woff'),
             url('http://guides.peruzal.com/introduction-to-sql/fonts/icon.ttf')
               format('truetype'),
             url('http://guides.peruzal.com/introduction-to-sql/fonts/icon.svg')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="http://guides.peruzal.com/introduction-to-sql/stylesheets/application.css">
    <link rel="stylesheet" href="http://guides.peruzal.com/introduction-to-sql/stylesheets/temporary.css">
    <link rel="stylesheet" href="http://guides.peruzal.com/introduction-to-sql/stylesheets/palettes.css">
    <link rel="stylesheet" href="http://guides.peruzal.com/introduction-to-sql/stylesheets/highlight/highlight.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/styles/github-gist.min.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu&#43;Mono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <script src="http://guides.peruzal.com/introduction-to-sql/javascripts/modernizr.js"></script>

    

  </head>
  <body class="palette-primary-deep-orange palette-accent-light-blue">




<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        Stored Procedures
      </div>
    </div>

    
    <div class="button button-twitter" role="button" aria-label="Twitter">
       <a href="https://twitter.com/peruzal" title="@peruzal on Twitter" target="_blank" class="toggle-button icon icon-twitter"></a>
    </div>
    

    
    <div class="button button-github" role="button" aria-label="GitHub">
      <a href="https://github.com/peruzal" title="@peruzal on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
    </div>
    
    
        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="http://guides.peruzal.com/introduction-to-sql" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="http://guides.peruzal.com/introduction-to-sql/images/logo.png">
        </div>
      
      <div class="name">
        <strong>Introduction to SQL <span class="version">1.0.0</span></strong>
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      

      <div class="toc">
        
        <ul>
          




<li>
  
    



<a  title="Understanding SQL" href="http://guides.peruzal.com/introduction-to-sql/understanding-sql/">
	
	Understanding SQL
</a>



  
</li>



<li>
  
    



<a  title="Retrieving Data" href="http://guides.peruzal.com/introduction-to-sql/retrieving-data/">
	
	Retrieving Data
</a>



  
</li>



<li>
  
    



<a  title="Sorting Data" href="http://guides.peruzal.com/introduction-to-sql/sorting-data/">
	
	Sorting Data
</a>



  
</li>



<li>
  
    



<a  title="Filtering Data" href="http://guides.peruzal.com/introduction-to-sql/filtering-data/">
	
	Filtering Data
</a>



  
</li>



<li>
  
    



<a  title="Functions Data" href="http://guides.peruzal.com/introduction-to-sql/functions/">
	
	Functions Data
</a>



  
</li>



<li>
  
    



<a  title="Grouping Data" href="http://guides.peruzal.com/introduction-to-sql/grouping-data/">
	
	Grouping Data
</a>



  
</li>



<li>
  
    



<a  title="Sub Queries" href="http://guides.peruzal.com/introduction-to-sql/subqueries/">
	
	Sub Queries
</a>



  
</li>



<li>
  
    



<a  title="Joining Tables" href="http://guides.peruzal.com/introduction-to-sql/joining-tables/">
	
	Joining Tables
</a>



  
</li>



<li>
  
    



<a  title="Inserting Data" href="http://guides.peruzal.com/introduction-to-sql/inserting-data/">
	
	Inserting Data
</a>



  
</li>



<li>
  
    



<a  title="Updating Data" href="http://guides.peruzal.com/introduction-to-sql/updating-data/">
	
	Updating Data
</a>



  
</li>



<li>
  
    



<a  title="Deleting Data" href="http://guides.peruzal.com/introduction-to-sql/deleting-data/">
	
	Deleting Data
</a>



  
</li>



<li>
  
    



<a  title="Working with Tables" href="http://guides.peruzal.com/introduction-to-sql/working-with-tables/">
	
	Working with Tables
</a>



  
</li>



<li>
  
    



<a  title="Views" href="http://guides.peruzal.com/introduction-to-sql/views/">
	
	Views
</a>



  
</li>



<li>
  
    



<a class="current" title="Stored Procedures" href="http://guides.peruzal.com/introduction-to-sql/stored-procedures/">
	
	Stored Procedures
</a>


<ul id="scrollspy">
</ul>


  
</li>



<li>
  
    



<a  title="Transaction" href="http://guides.peruzal.com/introduction-to-sql/transactions/">
	
	Transaction
</a>



  
</li>



<li>
  
    



<a  title="Advanced SQL Features" href="http://guides.peruzal.com/introduction-to-sql/advanced-sql-features/">
	
	Advanced SQL Features
</a>



  
</li>



<li>
  
    



<a  title="Calculated Fields" href="http://guides.peruzal.com/introduction-to-sql/calculated-fields/">
	
	Calculated Fields
</a>



  
</li>



<li>
  
    



<a  title="Installing SQL Server" href="http://guides.peruzal.com/introduction-to-sql/installing-sql-server/">
	
	Installing SQL Server
</a>



  
</li>



<li>
  
    



<a  title="SQL Server Architecture" href="http://guides.peruzal.com/introduction-to-sql/sql-server-architecture/">
	
	SQL Server Architecture
</a>



  
</li>



<li>
  
    



<a  title="Database Recovery" href="http://guides.peruzal.com/introduction-to-sql/database-recovery/">
	
	Database Recovery
</a>



  
</li>



<li>
  
    



<a  title="Security" href="http://guides.peruzal.com/introduction-to-sql/database-security/">
	
	Security
</a>



  
</li>



<li>
  
    



<a  title="AlwaysOn Availability Groups" href="http://guides.peruzal.com/introduction-to-sql/sql-server-alwayson/">
	
	AlwaysOn Availability Groups
</a>



  
</li>



<li>
  
    



<a  title="Intro to SQL" href="http://guides.peruzal.com/introduction-to-sql/">
	
	Intro to SQL
</a>



  
</li>


        </ul>
        

        
        <hr>
        <span class="section">The author</span>
        
        <ul>
          
          <li>
            <a href="https://twitter.com/peruzal" target="_blank" title="@peruzal on Twitter">
              @peruzal on Twitter
            </a>
          </li>
          

          
          <li>
            <a href="https://github.com/peruzal" target="_blank" title="@peruzal on GitHub">
              @peruzal on GitHub
            </a>
          </li>
          

          
          <li>
            <a href="mailto:hello@peruzal.com" title="Email of hello@peruzal.com">
              Contact via email
            </a>
          </li>
          
        </ul>
        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1>Stored Procedures </h1>

			

<h2 id="understanding-stored-procedures">Understanding Stored Procedures</h2>

<p>Stored procedures are simply collections of one or more SQL statements saved for future use. You can think of them as batch files, although in truth they are more than that.</p>

<h2 id="why-to-use-stored-procedures">Why to Use Stored Procedures</h2>

<p>Stored procedures provides the following benefits :</p>

<ul>
<li>Simplicity</li>
<li>Security</li>
<li>Performance</li>
</ul>

<p>In brief, store procedures can be used to :</p>

<ul>
<li><p>To simplify complex operations (as seen in the previous example) by encapsulating processes into a single easy-to-use unit.</p></li>

<li><p>To ensure data consistency by not requiring that a series of steps be created over and over. If all developers and applications use the same stored procedure, then the same code will be used by all. An extension of this is to prevent errors. The more steps that need to be performed, the more likely it is that errors will be introduced. Preventing errors ensures data consistency.</p></li>

<li><p>To simplify change management. If tables, column names, or business logic (or just about anything) changes, then only the stored procedure code needs to be updated, and no one else will need even to be aware that changes were made. An extension of this is security. Restricting access to underlying data via stored procedures reduces the chance of data corruption (unintentional or otherwise).</p></li>

<li><p>Because stored procedures are usually stored in a compiled form, the DBMS has to do less work to process the command. This results in improved performance.</p></li>

<li><p>There are SQL language elements and features that are available only within single requests. Stored procedures can use these to write code that is more powerful and flexible.</p></li>
</ul>

<h2 id="executing-stored-procedures">Executing Stored Procedures</h2>

<p>Stored procedures are executed far more often than they are written, so we’ll start there. The SQL statement to execute a stored procedure is simply <strong>EXECUTE</strong>. <strong>EXECUTE</strong> takes the name of the stored procedure and any parameters that need to be passed to it.</p>

<p>Here is an example :</p>

<pre><code class="language-sql">exec sp_who2
</code></pre>

<p>or using the longer version of the keyword :</p>

<pre><code class="language-sql">EXECUTE sp_who2
</code></pre>

<h2 id="creating-stored-procedures">Creating Stored Procedures</h2>

<p>Lets create a stored procedure that counts the number of customers in a mailing list who have e-mail addresses.</p>

<pre><code class="language-sql">CREATE PROCEDURE MailingListCount
AS
DECLARE @cnt INTEGER
SELECT @cnt = COUNT(*)
FROM Customers
WHERE NOT cust_email IS NULL;
RETURN @cnt;
</code></pre>

<p>This stored procedure takes no parameters at all. The calling application retrieves the value by using SQL Server’s return code support. Here a local variable named <em>@cnt</em> is declared using the <strong>DECLARE</strong> statement (all local variables in SQL Server are named starting with a_ @_). This variable is then used in the <strong>SELECT</strong> statement so that it contains the value returned by the <strong>COUNT(</strong>) function. Finally, the RETURN statement is used to return the count to the calling application as RETURN <em>@cnt</em>.</p>

<p>To invoke the SQL Server example you could do the following:</p>

<pre><code class="language-sql">DECLARE @ReturnValue INT
EXECUTE @ReturnValue=MailingListCount;
SELECT @ReturnValue;
</code></pre>

<p>This code declares a variable to hold whatever the stored procedure returns, executes the store procedure, and then uses a <strong>SELECT</strong> to display the returned value.</p>

<p>Here’s another example, this time to insert a new order in the Orders table :</p>

<pre><code class="language-sql">CREATE PROCEDURE NewOrder @cust_id CHAR(10)
AS
-- Declare variable for order number
DECLARE @order_num INTEGER
-- Get current highest order number
SELECT @order_num=MAX(order_num)
FROM Orders
-- Determine next order number
SELECT @order_num=@order_num + 1
-- Insert new order
INSERT INTO Orders(order_num, order_date, cust_id)
VALUES(@order_num, GETDATE(), @cust_id)
-- Return order number
RETURN @order_num;
</code></pre>

<p>This stored procedure creates a new order in the Orders table. It takes a single parameter, the <em>ID</em> of the customer placing the order. The other two table columns, the order number and order date, are generated automatically within the stored procedure itself. The code first declares a local variable to store the order number. Next, the current highest order number is retrieved (using a <strong>MAX()</strong> function) and incremented (using a <strong>SELECT</strong> statement). Then the order is inserted with an INSERT statement using the newly generated order number, the current system date (retrieved using the <strong>GETDATE()</strong> function), and the passed customer <strong>ID</strong>. Finally, the order number (which is needed to process order items) is returned as <strong>RETURN @order_num</strong>.</p>

<p>Here’s a quite different version of the same SQL Server code:</p>

<pre><code class="language-sql">CREATE PROCEDURE NewOrder @cust_id CHAR(10)
AS
-- Insert new order
INSERT INTO Orders(cust_id)
VALUES(@cust_id)
-- Return order number
SELECT order_num = @@IDENTITY;
</code></pre>


			<aside class="copyright" role="note">
				
				&copy; 2017 Copyright 2017 Peruzal &ndash;
				
				Documentation built with
				<a href="https://www.gohugo.io" target="_blank">Hugo</a>
				using the
				<a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme.
			</aside>

			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="http://guides.peruzal.com/introduction-to-sql/transactions/" title="Transactions">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Transactions
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="http://guides.peruzal.com/introduction-to-sql/views/" title="Views">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              Views
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = '';
      var repo_id  = '';
    
    </script>

    <script src="http://guides.peruzal.com/introduction-to-sql/javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "#";
            headers[i].appendChild(a);
        }
      }
    </script>

    

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

