<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>Android Fundamentals - Mobile Device Security and Penetration Testing Guide</title>
    <meta name="generator" content="Hugo 0.31.1" />

    
    <meta name="description" content="Mobile Device Security and Penetration Testing guide">
    
    <link rel="canonical" href="https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guide/android-fundamentals/">
    
    <meta name="author" content="Peruzal">
    

    <meta property="og:url" content="https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guide/android-fundamentals/">
    <meta property="og:title" content="Mobile Device Security and Penetration Testing Guide">
    <meta property="og:image" content="https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guide/images/logo.png">
    <meta name="apple-mobile-web-app-title" content="Mobile Device Security and Penetration Testing Guide">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guide/images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guide/images/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guide/fonts/icon.eot');
        src: url('https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guide/fonts/icon.eot')
               format('embedded-opentype'),
             url('https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guide/fonts/icon.woff')
               format('woff'),
             url('https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guide/fonts/icon.ttf')
               format('truetype'),
             url('https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guide/fonts/icon.svg')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guide/stylesheets/application.css">
    <link rel="stylesheet" href="https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guide/stylesheets/temporary.css">
    <link rel="stylesheet" href="https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guide/stylesheets/palettes.css">
    <link rel="stylesheet" href="https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guide/stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu&#43;Mono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <script src="https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guide/javascripts/modernizr.js"></script>

    

  </head>
  <body class="palette-primary-red palette-accent-teal">




<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        Android Fundamentals
      </div>
    </div>

    
    <div class="button button-twitter" role="button" aria-label="Twitter">
       <a href="https://twitter.com/peruzal" title="@peruzal on Twitter" target="_blank" class="toggle-button icon icon-twitter"></a>
    </div>
    

    
    <div class="button button-github" role="button" aria-label="GitHub">
      <a href="https://github.com/peruzal" title="@peruzal on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
    </div>
    
    
        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guide" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guideimages/logo.png">
        </div>
      
      <div class="name">
        <strong>Mobile Device Security and Penetration Testing Guide <span class="version">1.0.0</span></strong>
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      

      <div class="toc">
        
        <ul>
          




<li>
  
    



<a  title="Getting Started" href="https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guide/getting-started/">
	
	Getting Started
</a>



  
</li>



<li>
  
    



<a  title="Mobile App Ecosystem" href="https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guide/mobile-app-ecosystem/">
	
	Mobile App Ecosystem
</a>



  
</li>



<li>
  
    



<a  title="Mobie App Attack Vectors" href="https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guide/mobile-device-attack-vectors/">
	
	Mobie App Attack Vectors
</a>



  
</li>



<li>
  
    



<a  title="Setting Up Android Lab Environment" href="https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guide/setting-up-android-lab-environment/">
	
	Setting Up Android Lab Environment
</a>



  
</li>



<li>
  
    



<a class="current" title="Android  Fundamentals" href="https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guide/android-fundamentals/">
	
	Android  Fundamentals
</a>


<ul id="scrollspy">
</ul>


  
</li>



<li>
  
    



<a  title="Rooting Android Devices" href="https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guide/rooting-android-devices/">
	
	Rooting Android Devices
</a>



  
</li>



<li>
  
    



<a  title="Android Security Model" href="https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guide/android-security-model/">
	
	Android Security Model
</a>



  
</li>



<li>
  
    



<a  title="Android Forensic Tools" href="https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guide/android-forensic-tools/">
	
	Android Forensic Tools
</a>



  
</li>



<li>
  
    



<a  title="Android Data Extraction" href="https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guide/android-data-extraction/">
	
	Android Data Extraction
</a>



  
</li>



<li>
  
    



<a  title="OWASP Mobile Top 10 Risks" href="https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guide/owasp-mobile-top-10-risks/">
	
	OWASP Mobile Top 10 Risks
</a>



  
</li>



<li>
  
    



<a  title="Android Insecure Data Storage" href="https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guide/android-insecure-data-storage/">
	
	Android Insecure Data Storage
</a>



  
</li>



<li>
  
    



<a  title="Setting Up iOS Development Environment" href="https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guide/setting-up-ios-development-environment/">
	
	Setting Up iOS Development Environment
</a>



  
</li>



<li>
  
    



<a  title="Setting Up an iOS Pentesting Lab" href="https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guide/setting-up-ios-pentesting-lab/">
	
	Setting Up an iOS Pentesting Lab
</a>



  
</li>



<li>
  
    



<a  title="Jailbreaking iOS Devices" href="https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guide/jailbreaking-ios-devices/">
	
	Jailbreaking iOS Devices
</a>



  
</li>



<li>
  
    



<a  title="iOS Internals Overview" href="https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guide/ios-internals/">
	
	iOS Internals Overview
</a>



  
</li>



<li>
  
    



<a  title="Data Acqusition from iOS Devices" href="https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guide/ios-data-acqusition/">
	
	Data Acqusition from iOS Devices
</a>



  
</li>



<li>
  
    



<a  title="iOS Data Analysis and Recovery" href="https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guide/ios-data-analysis-and-recovery/">
	
	iOS Data Analysis and Recovery
</a>



  
</li>



<li>
  
    



<a  title="iOS Insecure Local Data Storage" href="https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guide/ios-insecure-local-data-storage/">
	
	iOS Insecure Local Data Storage
</a>



  
</li>



<li>
  
    



<a  title="iOS Unintended Data Leakage" href="https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guide/ios-unintended-data-leakage/">
	
	iOS Unintended Data Leakage
</a>



  
</li>



<li>
  
    



<a  title="iOS Traffic Analysis" href="https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guide/ios-traffic-analysis/">
	
	iOS Traffic Analysis
</a>



  
</li>



<li>
  
    



<a  title="iOS Runtime Analysis" href="https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guide/ios-runtime-analysis/">
	
	iOS Runtime Analysis
</a>



  
</li>



<li>
  
    



<a  title="iOS Network Attacks" href="https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guide/ios-network-attacks/">
	
	iOS Network Attacks
</a>



  
</li>



<li>
  
    



<a  title="Mobile Malware" href="https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guide/mobile-malware/">
	
	Mobile Malware
</a>



  
</li>



<li>
  
    



<a  title="License" href="https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guide/license/">
	
	License
</a>



  
</li>



<li>
  
    



<a  title="Mobile App Device Security and Penetration Testing" href="https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guide/">
	
	Mobile App Device Security and Penetration Testing
</a>



  
</li>


        </ul>
        

        
        <hr>
        <span class="section">The author</span>
        
        <ul>
          
          <li>
            <a href="https://twitter.com/peruzal" target="_blank" title="@peruzal on Twitter">
              @peruzal on Twitter
            </a>
          </li>
          

          
          <li>
            <a href="https://github.com/peruzal" target="_blank" title="@peruzal on GitHub">
              @peruzal on GitHub
            </a>
          </li>
          

          
          <li>
            <a href="mailto:info@peruzal.co.za" title="Email of info@peruzal.co.za">
              Contact via email
            </a>
          </li>
          
        </ul>
        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1>Android Fundamentals </h1>

			

<h2 id="basics-of-android">Basics of Android</h2>

<p>An Android app is made up several components :</p>

<ul>
<li>Activity</li>
<li>Service</li>
<li>Content Provider</li>
<li>Broadcast Receivers</li>
</ul>

<h2 id="activity">Activity</h2>

<p>An activity is equivalent to one screen of an app. Common activities are login, sign up, stream, settings and on-boarding screens. Most the apps
functionality is performing with activities. Most the security testing is done here.
An activity has an entry in the AndroidManifest.xml file.</p>

<pre><code class="language-xml">&lt;activity android:label=&quot;@string/login_activity&quot; android:name=&quot;com.peruzal.praat.LoginActivity&quot; /&gt;
</code></pre>

<p>A common security vulnerability is <code>exported activities</code>. These are activities that can be started by the Android runtime.
Any app can start an exported activity.</p>

<h2 id="service">Service</h2>

<p>A service runs in the background, it does not have a user interface. They are usually
used for performing long running tasks in the background. A service also has an entry in the AndroidManifest.xml file :</p>

<pre><code class="language-xml">&lt;service android:label=&quot;@string/d1&quot; android:name=&quot;com.peruzal.praat.ChatService&quot; /&gt;
</code></pre>

<h2 id="content-providers">Content Providers</h2>

<p>The content provider are used to make private data of an app available to other apps using a common interface. The content provider
offers a <code>CRUD(Crud Read Update Delete)</code> interface to its data. The content providers are usually backed up with an SQLite database, which might
be vulnerable to SQL Injection attacks.</p>

<p>A common vulnerability is exported content providers. Any app can access the content provider provided they know the url.
Content provider urls start with the <code>content://</code> scheme.</p>

<p>Content providers also have an entry in the AndroidManifest.xml:</p>

<pre><code class="language-xml">&lt;provider android:name=&quot;jakhar.aseem.diva.NotesProvider&quot; android:enabled=&quot;true&quot; android:exported=&quot;true&quot; android:authorities=&quot;jakhar.aseem.diva.provider.notesprovider&quot; /&gt;
</code></pre>

<h2 id="broadcast-receivers">Broadcast Receivers</h2>

<p>This is the publish/subscribe mechanism on Android. Broadcast receiver are used by developer to build a decoupled app.
An activity can communicate with a service by using broadcast receivers. Broadcast receivers can configured to just send
and receive the broadcast within the app or globally for the whole Android system.</p>

<p>The Android system also sends out notifications as broadcast, e.g. battery low status, incoming phone call, sms received, connected to power and more.</p>

<h2 id="apk-structure">apk structure</h2>

<p>An Android app is installed from an apk package. Android apps are usually installed from the Google Play store.
For device security testing you would normally install the apk manually on the device using adb.</p>

<p>An apk is an archive format. We can un-archive the apk by converting the file extension to <code>.zip</code>. On the terminal</p>

<p><code>mv file.apk file.zip</code></p>

<p>and then unzip</p>

<p><code>unzip file.zip</code></p>

<h3 id="apk-file-structure">apk file structure</h3>

<p>The un-archived apk contains the following files :</p>

<ul>
<li>AndroidManifest.xml</li>
<li>assets</li>
<li>classes.dex</li>
<li>META-INF folder</li>
<li>lib folder</li>
<li>res folder</li>

<li><p>resources.arsc</p></li>

<li><p><code>AndroidManifest.xml</code>, This is the glue between the application and the Android runtime.
This is a configuration file, it contains config data like permissions required by the app, minimum version of Android required, the package name of the app.</p></li>

<li><p><code>assets</code>, This folder contains non-compiled resources such as raw files, music, databases and video.</p></li>

<li><p><code>classes.dex</code>, This file contains the intermediate code that can be run on the Dalvik runtime or Android Runtime.</p></li>

<li><p><code>META-INF</code>, this folder contains the app&rsquo;s certificate and the SHA1 digests.</p></li>

<li><p><code>resources.arsc</code>, this file contains the compiled assets</p></li>

<li><p><code>res</code>, this contains the compiled <code>res</code> folder.</p></li>
</ul>

<h2 id="getting-an-apk">Getting an apk</h2>

<ul>
<li>The Google Play store does not offer an option to download the apk but they are several website that allow you to download the apk from the Play store.</li>
<li>From the device. Using ad you can pull the apk from the device.</li>
</ul>

<h2 id="android-apk-storage-location">Android APK Storage Location</h2>

<p>The Android system stores <code>apk</code> files in different places depending on whether they are installed by the user or they came pre-installed on the device.
Instead of an <code>apk</code> file, Android also generates <code>.odex</code> files. These are optimized versions of the apk.</p>

<h2 id="user-installed-apps">User installed apps</h2>

<p>User installed apps are found under the <code>/data/app</code> directory. The apps under this folder are world-readable, anyone can copy them out from the device. No need for <strong>root</strong> user permissions.
The app&rsquo;s folder is found under <code>/data/data/&lt;package-name&gt;</code>.</p>

<h2 id="system-apps">System apps</h2>

<p>Apps that come with the system are found under the <code>/system/app</code> folder. The files under this folder are worl readable and anyone can extract them from the device.</p>

<h2 id="apps-with-special-copy-protection">Apps with special copy protection</h2>

<p>Apps that require special copy protection are found under the <code>/data/app-private</code> folder. Only users with the right permission can access the app from this folder.
The <code>root</code> user have permission to this folder.</p>

<h2 id="extracting-apk-file-from-device">Extracting apk file from device</h2>

<p>To extract an apk file from the device requires three steps :</p>

<ul>
<li>Find the package name.</li>
<li>Find the path of the APK file on the device.</li>
<li>Pull it out from the device.</li>
</ul>

<h3 id="list-installed-apps">List installed apps</h3>

<p>Find all the installed apps using the <code>adb</code> tool from the command line.</p>

<pre><code class="language-sh">$ adb shell pm list packages
</code></pre>

<h3 id="find-apk-path">Find apk path</h3>

<p>Use the package name from the <code>adb shell pm list packages</code> to find the path of the apk</p>

<pre><code class="language-sh">$ adb shell pm path com.android.email
</code></pre>

<h3 id="extract-the-apk">Extract the apk</h3>

<p>Extract the app&rsquo;s apk from the device once you know the path.</p>

<pre><code class="language-sh">$ adb pull /system/app/Email/Email.apk
</code></pre>

<h2 id="android-build-process">Android build process</h2>

<p>When Java code is compiled, its compiled into the Java bytecode. The bytecode cannot run on Android, this further translated by the Android Runtime
starting with Android 5.0 or with the Dalvim VM for older Android.</p>

<ul>
<li>Java files ending in <code>.java</code> are compiled into <code>.class</code>. The .class is the Java bytecode.</li>
<li>The <code>dx</code> tool is used to convert the <code>.class</code> into <code>dex</code>, which can be run on Android.</li>
</ul>

<h3 id="compiling-java-source-to-bytecode">Compiling Java source to bytecode</h3>

<p>Lets use the following source named <code>HackingAndroid.java</code> filename :</p>

<pre><code class="language-java">public class HackingAndroid {
     public static void main(String[] args){
     System.out.println(&quot;Hacking Android&quot;);
  }
}
</code></pre>

<h3 id="compile-the-code">Compile the code</h3>

<pre><code class="language-sh">javac HackingAndroid.java
</code></pre>

<p>and this produces a file called <code>HackingAndroid.class</code>.</p>

<h3 id="run-the-app">Run the app</h3>

<pre><code class="language-sh">java HackingAndroid
</code></pre>

<h3 id="convert-the-app-to-run-on-android">Convert the app to run on Android</h3>

<p>Using the <code>dx</code> tool we can convert the bytecode into dex format thats executable on Android.</p>

<pre><code class="language-sh">dx --dex --output=HackingAndroid.dex HackingAndroid.class
</code></pre>

<h3 id="copy-the-dex-file-to-the-device">Copy the dex file to the device</h3>

<pre><code class="language-sh">adb push HackingAndroid.dex /data/local/tmp
</code></pre>

<h3 id="run-the-app-on-the-device">Run the app on the device</h3>

<p>Use adb to run the app</p>

<pre><code class="language-sh">adb shell dalvikvm â€“cp /data/local/tmp/HackingAndroid.dex
</code></pre>


			<aside class="copyright" role="note">
				
				&copy; 2018 Peruzal Mobile Device Security and Penetration Testing Guide &ndash;
				
				Documentation built with
				<a href="https://www.gohugo.io" target="_blank">Hugo</a>
				using the
				<a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme.
			</aside>

			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guide/android-security-model/" title="Android Security Model">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Android Security Model
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guide/setting-up-android-lab-environment/" title="Setting up Android Lab Environment">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              Setting up Android Lab Environment
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = '';
      var repo_id  = '';
    
    </script>

    <script src="https://guides.peruzal.com/mobile-device-security-and-penetration-testing-guide/javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "#";
            headers[i].appendChild(a);
        }
      }
    </script>

    

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

